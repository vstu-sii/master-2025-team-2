## 1. Реляционная схема базы данных (PostgreSQL)
Реляционная модель обеспечивает строгую согласованность и целостность данных благодаря использованию нормализации и внешних ключей. Этот подход хорошо подходит для структурированных данных с четко определенными связями.
### 1.1. Описание таблиц
**Таблица users**
Представляет данные о пользователях системы.

| Поле | Тип данных	| Описание	| Ограничения |
| :--- | :--- | :--- | :--- |
| id	| BIGSERIAL	| Уникальный идентификатор пользователя	| primary key |
| FIO	TEXT	| Фамилия, имя и отчество пользователя 	| not null |
| Birthday	| DATE	| День рождения пользователя	| not null |
| Login	| TEXT	| Имя пользователя в системе	| not null |
| Password	| TEXT	| Хеш пароля пользователя	| not null |


**Таблица chats**
Сохраняет историю общения пользователя с LLM

| Поле       | Тип данных | Описание                                      | Ограничения  |
|:-----------|:-----------|:-----------------------------------------------|:-------------|
| id         | BIGSERIAL  | Уникальный идентификатор чата                  | primary key  |
| history    | TEXT       | Текстовый запрос пользователя и ответ LLM     | not null     |
| user_id    | BIGSERIAL  | Идентификатор пользователя                    | not null     |
| image      | TEXT       | Хеш-данные рентгеновского снимка               | —            |
| created_at | TIMESTAMP  | Дата и время запроса / ответа                  | not null     |

Таблица Image

| Поле | Тип данных | Описание                     | Ограничения |
|:-----|:-----------|:------------------------------|:------------|
| hash | TEXT       | Хеш-данные рентгеновского снимка | primary key |
| path | TEXT       | Путь к файлу снимка           | not null    |

### 1.2. Индексы для производительности

* idx_user_FIO ON users (FIO);
* idx_user_Birthday ON users (Birthday);
* idx_user_Login ON users (Login);
* idx_Image_path ON Image (path);
* idx_chat_id ON chats (id);
* idx_chat_created_at ON chats (created_at);

#### 1.3. ER-диаграмма (dbdiagram.io)

![Er-диаграмма](https://github.com/vstu-sii/master-2025-team-2/blob/main/database/Er-diagram.png)

## 2. Схема для данных LLM (Промпты и ответы)

Сценарий: «Автоматическое описание рентгеновского снимка» (основной)
SYSTEM prompt (фиксированный, служебный)
Ты — медицинская AI-модель, специализирующаяся на анализе рентгенологических изображений.
Отвечай строго в медицинской терминологии.
Формируй ответ в структурированном виде:
1) Качество снимка
2) Находки
3) Локализация
4) Оценка тяжести
5) Заключение
6) Рекомендации
Не ставь клинический диагноз, если данных недостаточно.

USER prompt (рентгенолог)
Проанализируй рентген грудной клетки пациента.
Опиши выявленные патологические изменения, если они присутствуют.
(к prompt прикреплён DICOM / PNG снимок)

ASSISTANT response (LLM)
1) Качество снимка:
Снимок выполнен в прямой проекции, экспозиция адекватная, визуализация лёгочных полей удовлетворительная.
2) Находки:
В нижних отделах правого лёгкого определяется участок пониженной прозрачности с нечеткими контурами.
Корни лёгких структурны, не расширены.
Сердечная тень без выраженных изменений.
3) Локализация:
Правое лёгкое, нижняя доля.
4) Оценка тяжести:
Изменения умеренной выраженности.
5) Заключение:
Рентгенологические признаки очагово-инфильтративных изменений в нижней доле правого лёгкого.
6) Рекомендации:
Рекомендуется клиническая корреляция и, при необходимости, контрольное исследование или КТ органов грудной клетки.
→ сохраняется как AI-черновик

Сценарий: «Редактирование AI-описания»
USER prompt (после правок врача)
Исправь формулировку заключения:
укажи, что изменения могут соответствовать воспалительному процессу.

ASSISTANT response
Обновлённое заключение:
Рентгенологические признаки очагово-инфильтративных изменений в нижней доле правого лёгкого, которые могут соответствовать воспалительному процессу. Рекомендуется клинико-лабораторная корреляция.

Сценарий: «Сравнение с предыдущими снимками пациента»
SYSTEM prompt
Ты — медицинская AI-модель.
Сравни текущий и предыдущий рентгеновские снимки.
Определи динамику изменений.

USER prompt
Сравни текущий рентген грудной клетки с исследованием от 12.02.2024.
Определи динамику патологических изменений.
(прикреплены два снимка)

ASSISTANT response
При сравнении текущего исследования с рентгенограммой от 12.02.2024 отмечается:
— уменьшение размеров инфильтративного участка в нижней доле правого лёгкого,
— повышение прозрачности лёгочной ткани в зоне ранее выявленных изменений.

Динамика расценивается как положительная, что может свидетельствовать об эффективности проводимого лечения.
