# User Journey: Разработка системы анализа рентгенов груди с помощью LLM

![User_journey](design/user-flows.png)

## Общее описание:
Данный пользовательский путь описывает взаимодействие врача (рентгенолога, терапевта) с системой, которая использует искусственный интеллект для анализа рентгеновских снимков и автоматического формирования медицинского заключения. Цель системы — ускорить и стандартизировать процесс диагностики, снизив нагрузку на специалиста и минимизировав человеческие ошибки.

## Этап 1: Регистрация

**Цель клиента:** Зарегистрировать аккаунт в системе для последующего использования.

**Действия пользователя:**
- Заходит на сайт системы.
- Заполняет обязательные поля: email, пароль, имя.
- Нажимает кнопку «Зарегистрировать».

**Нейтральные эмоции** - процесс регистрации стандартный, прост и интуитивно понятен.

**Барьеры:** Нет барьеров.

**Идеи для улучшения:** Улучшения не нужны.

## Этап 2: Вход в систему

**Цель клиента:** Зайти в свой аккаунт для начала работы.

**Действия пользователя:**
- Вводит данные аккаунта (логин и пароль).
- Нажимает кнопку входа и попадает в систему.

**Положительные эмоции** - процесс стандартный.

**Барьеры:**
- Пользователь может забыть пароль от аккаунта.

**Идеи для улучшения:**
- Добавить функцию восстановления пароля через email или SMS.

## Этап 3: Получение сгенерированного медицинского заключения

**Цель клиента:** Получить предварительное медицинское заключение, сгенерированное ИИ на основе рентгеновского снимка.

**Действия пользователя:**
- Загружает рентгеновский снимок в систему.
- Добавляет текстовый запрос (например, уточняющие вопросы или контекст).
- Нажимает кнопку «Генерировать».

**Положительные эмоции** - пользователь ожидает быстрого и точного результата, чувствует уверенность в технологии.

**Барьеры:**
- Размер файла превышает 15 МБ.
- Файл имеет неподдерживаемый формат.
- ИИ может выдать некорректный или неточный ответ.

**Идеи для улучшения:**
- Добавить автоматическое сжатие файлов при превышении лимита.
- Расширить список поддерживаемых форматов изображений.
- Провести тщательную настройку и калибровку ИИ-модели для повышения точности диагнозов.

## Этап 4: Редактирование сгенерированного медицинского заключения

**Цель клиента:** Составить финальное медицинское заключение на основе сгенерированного ИИ варианта.

**Действия пользователя:**
- Проверяет сгенерированное заключение на наличие ошибок или неточностей.
- Редактирует текст, исправляет или дополняет информацию.
- Утверждает окончательную версию заключения.

**Негативные эмоции** - пользователь внимателен, сильно напряжён из-за ответственности за финальный текст. Настроение пользователя зависит от качества сгенерированного ответа, поэтому необходимо работать над настройкой LLM-модели.

**Барьеры:**
- Возможна потеря данных при редактировании из-за сбоя в системе или случайного закрытия окна.

**Идеи для улучшения:**
- Внедрить функцию автосохранения изменений каждые 30 секунд.

## Этап 5: Сравнение с предыдущими снимками пациента

**Цель клиента:** Получить полную картину истории болезни пациента, сравнив текущий снимок с архивными.

**Действия пользователя:**
- Запрашивает в системе сравнение текущего снимка с предыдущими исследованиями пациента.
- Использует полученный сравнительный отчёт для формирования финального заключения.

**Нейтральные эмоции** - пользователь спокойно изучает отчёт об истории болезни пациента.

**Барьеры:**
- История болезни пациента может отсутствовать в системе или быть неполной.

**Идеи для улучшения:**
- Добавить возможность ручного поиска пациента в системе PACS (архив медицинских изображений).

## Этап 6: Интегрирование медицинского заключения в цифровой архив пациента

**Цель клиента:** Сохранить финальное медицинское заключение в цифровой архив пациента для дальнейшего доступа и использования.

**Действия пользователя:**
- Система автоматически находит историю болезни пациента в PACS.
- Пользователь добавляет финальное заключение в существующий архив пациента.

**Положительные эмоции** - удовлетворение от завершённого процесса и сохранения результатов в централизованном архиве.

**Барьеры:**
- Возможны ошибки синхронизации между системой и PACS.

**Идеи для улучшения:**
- Реализовать механизм локального сохранения данных с пометкой для повторной отправки в случае сбоя синхронизации.

## Общий вывод:
Представленный пользовательский путь отражает ключевые этапы взаимодействия врача с ИИ-системой для анализа рентгеновских снимков. Система в целом удобна и логична, однако требует доработок в области обработки файлов, интеграции с архивами и повышения надёжности хранения данных. Внедрение предложенных улучшений позволит повысить удовлетворённость пользователей и эффективность диагностического процесса.

## Edge Cases для Happy Path (Автоматическое описание рентгеновского снимка)

### Edge Case 1: Снимок с минимальными диагностическими признаками
**Ситуация:** На рентгеновском снимке практически отсутствуют патологические изменения

**Шаги:**
- LLM-сервис определяет, что снимок показывает нормальную анатомию
- Система генерирует заключение: "Патологических изменений не выявлено"
- Рентгенолог проверяет и подтверждает

**Особенности:** Возможность добавления примечания "Рекомендован контроль через 6 месяцев" для возрастных пациентов

### Edge Case 2: Множественные патологии на одном снимке
**Ситуация:** Обнаружено более 3-х различных патологий

**Шаги:**
- LLM-сервис выделяет все обнаруженные аномалии по приоритету клинической значимости
- Система предлагает структурированный список с ранжированием
- Рентгенолог проверяет полноту выявленных изменений

**Особенности:** Автоматическое выделение наиболее критичных находок для срочного внимания лечащего врача

### Edge Case 3: Пограничные случаи диагностики
**Ситуация:** AI не уверен в наличии/отсутствии патологии

**Шаги:**
- LLM-сервис указывает степень уверенности (например, 65%)
- Система добавляет пометку: "Требуется дополнительная проверка специалистом"
- Рентгенолог получает уведомление о низкой уверенности AI

**Особенности:** Возможность запросить второе мнение или дополнительные исследования

### Edge Case 4: Отсутствие метаданных пациента в снимке
**Ситуация:** Файл не содержит идентификационной информации

**Шаги:**
- Система запрашивает ручной ввод данных пациента
- Сохраняется отдельная категория "Снимки без метаданных"
- Администратор получает уведомление для ручной привязки

**Особенности:** Автоматический поиск похожих снимков в архиве по визуальным признакам

## UX Сценарии Ошибок

### UX Ошибка 1: Длительная обработка снимка
**Ситуация:** Обработка занимает более 2 минут

**Решение UX:**
- Показывать прогресс-бар с процентным индикатором
- Отображать статус: "Анализ 45% завершен - идет детализация патологий"
- Предлагать альтернативные действия (просмотр других исследований, редактирование черновиков)
- Отправлять push-уведомление при готовности

### UX Ошибка 2: Противоречивые результаты AI
**Ситуация:** При повторном анализе того же снимка AI дает разные заключения

**Решение UX:**
- Сохранять все версии анализа
- Визуально выделять различия между версиями
- Предлагать рентгенологу выбрать наиболее точную версию
- Отправлять инцидент в техническую поддержку для анализа

### UX Ошибка 3: Неполное заключение
**Ситуация:** AI пропустил очевидную патологию

**Решение UX:**
- Система отмечает "низкую полноту" анализа
- Предлагает проверить снимок по контрольному списку
- Включает подсказки: "Проверьте верхнюю долю правого легкого"
- Запрашивает причину пропуска для обучения модели

### UX Ошибка 4: Ошибка приоритизации
**Ситуация:** AI неверно определил срочность находок

**Решение UX:**
- Система предлагает ручную расстановку приоритетов
- Визуально маркирует срочные/несрочные находки
- Интегрируется с системой оповещений для критических случаев
- Отправляет уведомление лечащему врачу при обнаружении угрозы жизни

### UX Ошибка 5: Потеря контекста при редактировании
**Ситуация:** При редактировании теряется связь с оригинальным AI-заключением

**Решение UX:**
- Показывает оригинальный и редактируемый текст параллельно
- Сохраняет историю изменений с именами редакторов
- Предлагает "сравнить с оригиналом" в любой момент
- Визуально выделяет измененные участки

### UX Ошибка 6: Ошибки интеграции с PACS
**Ситуация:** Заключение сохранено, но не отображается в истории пациента

**Решение UX:**
- Показывает статус синхронизации в реальном времени
- Предлагает ручную повторную отправку при сбое
- Хранит локальную копию до успешной синхронизации
- Уведомляет администратора о проблемах соединения

### UX Ошибка 7: Неверная идентификация пациента
**Ситуация:** Снимок привязан к неверному пациенту

**Решение UX:**
- Валидация соответствия метаданных снимка и выбранного пациента
- Запрос подтверждения при несоответствиях
- Возможность массового перепривязывания исследований
- Аудит-лог изменений привязок

### UX Ошибка 8: Перегруженность интерфейса
**Ситуация:** На экране слишком много информации для анализа

**Решение UX:**
- Каскадное отображение - сначала основные находки, затем детали
- Возможность скрыть/показать технические детали
- Настройка отображения по предпочтениям рентгенолога
- "Фокусировка" на одной патологии при клике

### UX Ошибка 9: Отсутствие обратной связи от AI
**Ситуация:** Рентгенолог не понимает, почему AI принял то или иное решение

**Решение UX:**
- Кнопка "Объяснить вывод AI" с визуальной маркировкой областей интереса
- Показ уровня уверенности для каждой находки
- Ссылки на похожие случаи из базы знаний
- Интеграция с медицинскими справочниками

## Точки взаимодействия с LLM в системе анализа рентгеновских снимков груди

### 1. Первичный анализ загруженного снимка
**Когда:** Сразу после загрузки рентгеновского снимка пользователем

**Что передается:** Конвертированное изображение снимка, метаданные исследования, опциональный текстовый запрос рентгенолога

**Что ожидается:** Структурированное медицинское заключение с оценкой качества снимка, выявленными патологиями, их локализацией, описанием нормальных структур, срочными предупреждениями и рекомендациями

### 2. Уточнение по конкретной области снимка
**Когда:** Рентгенолог выделяет область интереса и задает уточняющий вопрос

**Что передается:** Фрагмент изображения выделенной области, координаты на оригинальном снимке, специфический вопрос, предыдущее заключение как контекст

**Что ожидается:** Детализированное описание выделенной области с метриками плотности, характеристиками краев, наличием кальцификатов, вовлечением сосудов и сравнением с типовыми паттернами

### 3. Сравнительный анализ с предыдущими исследованиями
**Когда:** Запрос на сравнение текущего снимка с архивными исследованиями пациента

**Что передается:** Текущий снимок, предыдущие снимки в хронологическом порядке, временные метки исследований, контекст лечения

**Что ожидается:** Отчет об изменениях с указанием стабильных находок, новых образований, разрешившихся патологий, скоростей прогрессирования и рекомендаций по дальнейшему наблюдению

### 4. Проверка согласованности после редактирования
**Когда:** После внесения рентгенологом правок в AI-заключение

**Что передается:** Оригинальное AI-заключение, отредактированная версия, метаданные о внесенных изменениях

**Что ожидается:** Анализ согласованности версий, выявление потенциальных противоречий, определение типа внесенных изменений, предложения по устранению несоответствий

### 5. Экспертная консультация при сложных случаях
**Когда:** Рентгенолог отмечает случай как сложный или спорный

**Что передается:** Снимок с аннотациями областей интереса, история болезни пациента, список дифференциальных диагнозов, конкретные вопросы рентгенолога

**Что ожидается:** Второе мнение с оценкой сложности случая, ранжированный список дифференциальных диагнозов с вероятностями, обоснование выводов, рекомендации по дополнительным исследованиям, ссылки на релевантную медицинскую литературу

### 6. Периодический аудит качества работы системы
**Когда:** Плановый или инициативный анализ точности системы

**Что передается:** Набор снимков с подтвержденными диагнозами, соответствующие AI-заключения, статистика предыдущих ошибок

**Что ожидается:** Отчет с метриками точности, выявлением паттернов ошибок, сравнением с человеческой экспертизой, рекомендациями по улучшению модели

### 7. Обучение на основе обратной связи
**Когда:** После подтверждения или исправления заключения рентгенологом

**Что передается:** Исходное предсказание AI, исправленная версия специалиста, аннотированные различия, информация об экспертизе рентгенолога

**Что ожидается:** Идентификация типа корректировки, определение пробелов в знаниях AI, извлечение новых паттернов для обучения, генерация тренировочных примеры

### 8. Экстренная оценка угрожающих состояний
**Когда:** Маркировка случая как "срочный" или "экстренный"

**Что передается:** Снимок с флагом срочности, минимальный клинический контекст, требование быстрого ответа

**Что ожидается:** Приоритизированный список угрожающих жизни находок, немедленные рекомендации по действиям, оценка тяжести состояния, определение получателей экстренных оповещений

## Микроинтеракции и обратная связь в системе анализа рентгеновских снимков груди

### 1. Загрузка и подготовка снимка
**Микроинтеракции:**
- Drag & Drop зона: Пользователь перетаскивает файл в выделенную область
- Кнопка выбора файла: Стандартный файловый диалог с фильтрацией по форматам
- Предпросмотр снимка: Миниатюра загруженного изображения с возможностью масштабирования
- Кроппинг инструменты: Выделение области интереса, если требуется частичный анализ
- Слайдер качества: Регулировка контраста/ярчности снимка перед анализом

**Обратная связь:**
- Валидация формата: Немедленное сообщение о неподдерживаемом формате
- Индикатор загрузки: Прогресс-бар с процентом загрузки
- Предупреждение о размере: "Файл 18MB будет сжат до 15MB"
- Авто-ротация: Снимок автоматически поворачивается в правильную ориентацию
- Подсказка по качеству: "Рекомендуем увеличить контраст для лучшего анализа"

### 2. Ввод контекстного запроса
**Микроинтеракции:**
- Интеллектуальное текстовое поле: Автодополнение медицинских терминов
- Кнопки быстрых запросов: "Детализировать патологию", "Исключить онкологию", "Оценить динамику"
- Выпадающий список шаблонов: Часто используемые формулировки запросов
- Голосовой ввод: Диктовка запроса через микрофон
- Прикрепление метаданных: Выбор возраста, пола, анамнеза из предустановленных вариантов

**Обратная связь:**
- Подсветка ключевых терминов: Медицинские термины выделяются цветом
- Контроль длины: Счетчик символов с рекомендацией оптимальной длины
- Подсказки в реальном времени: "Добавьте возраст пациента для более точного анализа"
- Визуализация сложности запроса: Индикатор от "простой" до "сложный"

### 3. Ожидание обработки LLM
**Микроинтеракции:**
- Кнопка паузы/приоритизации: Возможность поставить анализ в очередь
- Миниатюризация процесса: Сворачивание окна обработки в мини-панель
- Добавление в очередь: Возможность загрузить следующий снимок во время обработки текущего

**Обратная связь:**
- Многоуровневый прогресс-бар:
  - Загрузка: 0-10%
  - Предобработка: 10-30%
  - Анализ AI: 30-80%
  - Форматирование: 80-100%
- Динамические подсказки:
  - "Анализирую легочные поля..."
  - "Выявляю патологические тени..."
  - "Формирую дифференциальный диагноз..."
- Прогноз времени: "Примерное время до завершения: 45 секунд"
- Визуализация этапов: Анимация сканирующей линии по снимку

### 4. Просмотр и взаимодействие с результатами
**Микроинтеракции:**
- Табы: Структурированное отображение разделов заключения
- Ховер-эффекты: При наведении на термин — краткое пояснение
- Клик по патологии: Центрирование снимка на соответствующей области
- Сравнение режим: Side-by-side отображение снимка и текста заключения
- Зуммирование с привязкой: Увеличение области, упомянутой в текущем абзаце

**Обратная связь:**
- Цветовое кодирование:
  - Зеленый: Нормальные находки
  - Желтый: Незначительные отклонения
  - Оранжевый: Патологии средней значимости
  - Красный: Критические находки
- Индикаторы уверенности:
  - Высокая уверенность: Сплошная граница
  - Средняя уверенность: Пунктирная граница
  - Низкая уверенность: Мигающая граница
- Визуальные маркеры на снимке: Цифры/буквы, соответствующие пунктам в заключении
- Подсветка соответствия: При скроллинге текста подсвечивается соответствующая область снимка

### 5. Редактирование AI-заключения
**Микроинтеракции:**
- Inline-редактирование: Клик по тексту для прямого редактирования
- Быстрые замены: Выделение термина → выпадающий список альтернатив
- Drag & Drop перестановка: Изменение порядка разделов заключения
- Вставка шаблонов: Библиотека стандартных формулировок
- Комментирование: Добавление примечаний к конкретным пунктам

**Обратная связь:**
- Сравнение версий: Diff-режим, показывающий изменения относительно AI-версии
- Сохранение состояния: Таймер автосохранения (сохранено 15 секунд назад)
- Визуализация правок: Добавленный текст — зеленый, удаленный — красный
- Предупреждения о противоречиях: "Эта формулировка противоречит пункту 3 о локализации"
- Оценка полноты: Индикатор "полноты заключения" в процентах
